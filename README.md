# ðŸ“š Bookstore Backend API

A robust, modular, and production-ready Node.js backend for an online bookstore, built using modern best practices such as layered architecture, JWT authentication, role-based access control, background job queues for email notifications, and atomic operations for data consistency.

---

## âš™ï¸ Tech Stack

- **Node.js** & **Express.js** â€“ RESTful API
- **MongoDB** & **Mongoose** â€“ Flexible document database with schema validation
- **Redis** & **BullMQ** â€“ For background job queues and rate-limiting email sending
- **Nodemailer** â€“ Send transactional emails via SMTP
- **JWT** â€“ Secure authentication and role-based authorization
- **dotenv** â€“ Secure environment variable management

---

## ðŸ—‚ï¸ Project Structure

/backend
  â”œâ”€â”€ src/
  â”‚   â”œâ”€â”€ config/           # Database & Redis connection configs
  â”‚   â”œâ”€â”€ controllers/      # Request handling logic
  â”‚   â”œâ”€â”€ services/         # Core business logic
  â”‚   â”œâ”€â”€ repositories/     # Database queries (data access layer)
  â”‚   â”œâ”€â”€ models/           # Mongoose schemas for MongoDB
  â”‚   â”œâ”€â”€ middlewares/      # Auth, error handling, async handler
  â”‚   â”œâ”€â”€ jobs/             # BullMQ queue setup
  â”‚   â”œâ”€â”€ workers/          # BullMQ workers that run background jobs
  â”‚   â”œâ”€â”€ utils/            # Common utilities (email sending, AppError)
  â”‚   â”œâ”€â”€ routes/           # API route definitions
  â”‚   â”œâ”€â”€ app.js            # Express app setup (middleware, routes)
  â”‚   â”œâ”€â”€ server.js         # Entry point to start the server
  â”œâ”€â”€ .env                  # Local environment variables (not committed)
  â”œâ”€â”€ package.json          # Dependencies and scripts
  â”œâ”€â”€ README.md             # This documentation



---

## âœ… Features Implemented

### âœ”ï¸ User Authentication & Roles

- Users can register as **admin**, **author**, or **retail**.
- JWT authentication for secure API access.
- `verifyToken` and `checkRole` middleware ensure protected, role-based access.

---

### âœ”ï¸ Book Management

- **Create Books**
  - Each book gets a **unique `bookId`** (`book-1`, `book-2`, etc.) generated by counting existing books.
  - Book title is automatically converted to a **slug** for clean SEO-friendly URLs (`/books/basics-of-javascript`).
  - If multiple books have the same title, unique slugs like `basics-of-javascript-1` are generated.
  - Book `price` must be between **100 and 1000 INR**; validated with clear error messages.

- **Sell Count**
  - Every time a purchase happens, the bookâ€™s `sellCount` is incremented.
  - This is done using the MongoDB `$inc` operator to ensure atomicity and prevent race conditions.

---

## ðŸ§® Logic for Computing **Sell Count**

> ðŸ“ˆ **Why it matters:** The `sellCount` tracks how many times a book has been sold, used for analytics and popularity ranking.

- When a retail user purchases a book, the purchase service:
  1. Validates the book exists.
  2. Creates a new purchase with unique `purchaseId`.
  3. Calls `this.bookRepository.update({ _id: book._id },
            { $inc: { sellCount: purchase.quantity } })`.

- The repository updates the `sellCount` atomically:
  
